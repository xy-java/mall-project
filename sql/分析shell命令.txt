一、分析用户数量和销售总额hive_count
1、导入user_info ,order_info到hive
//user_info第一次导入加 --create-hive-table
sqoop import --connect jdbc:mysql://192.168.0.103:3306/test
 --username root --password 123456 --table user_info -m 1 
 --hive-import --hive-table test.user_info 
 --create-hive-table
 --target-dir /test/user_info --delete-target-dir --hive-overwrite
 
 //order_info到hive
 sqoop import --connect jdbc:mysql://192.168.0.103:3306/test --username root --password 123456 --table order_info -m 1 --hive-import --hive-table test.order_info --delete-target-dir --target-dir /test/order_info --hive-overwrite --create-hive-table 


2、hive分析两表数据导入hdfs
insert overwrite directory '/result/count' ROW FORMAT DELIMITED FIELDS TERMINATED BY '\001'
select * from (select count(*) from user_info where user_power='普通用户')a ,( select sum(total_amount) from order_info where order_status=1 )b

3、hdfs分析文件导入mysql
//导入前先清空mysql表数据
sqoop eval --connect jdbc:mysql://192.168.0.103:3306/test --username root --password 123456 --e "delete from hive_count"

sqoop export --connect jdbc:mysql://192.168.0.103:3306/test --username root --password 123456 --table hive_count --export-dir /result/count -m 1 
--input-fields-terminated-by '\001'

二、分析今天前7天的产品销售数量hive_analys
日期-数据

1、导入order_detail
sqoop import --connect jdbc:mysql://192.168.0.103:3306/test --username root --password 123456 --query "select * from (select * from order_detail where order_id in (select order_id from order_info where order_status = 1)
)c where \$CONDITIONS" -m 1 --hive-import --hive-table test.order_detail --delete-target-dir --target-dir /test/order_detail --hive-overwrite --create-hive-table 

2、hive分析数据导入hdfs

insert overwrite directory '/result/date' ROW FORMAT DELIMITED FIELDS TERMINATED BY '\t' select a.x_info,a.y_info,'date' as type from (select SUBSTR(create_time,1,10) as x_info,sum(order_num) as y_info from order_detail  GROUP BY SUBSTR(create_time,1,10))a where a.x_info between date_add(current_date,-6) and current_date;

3、hdfs分析文件导入mysql
//导入前先清空mysql表数据
sqoop eval --connect jdbc:mysql://192.168.0.103:3306/test --username root --password 123456 --e "delete from hive_analys"

sqoop export --connect jdbc:mysql://192.168.0.103:3306/test --username root --password 123456 --table hive_analys --export-dir /result/date -m 1 --input-fields-terminated-by '\t'

三、分析不同种类产品被购买情况hive_analys
产品类型-数量
1、导入表
sqoop import --connect jdbc:mysql://192.168.0.103:3306/test --username root --password 123456 -m 1 --hive-import --hive-table test.type_num --delete-target-dir --target-dir /test/type_num --hive-overwrite --create-hive-table --query "select * from (select b.sku_type,a.order_num,'num' as type from order_detail a,sku_info b where a.sku_id = b.sku_id and a.order_id in (select order_id from order_info where order_status = 1))c where \$CONDITIONS"

2、分析
insert overwrite directory '/result/type_num' ROW FORMAT DELIMITED FIELDS TERMINATED BY '\t' select sku_type as x_info,sum(order_num) as y_info,'num' as type from type_num group by sku_type


3、导出到mysql
sqoop eval --connect jdbc:mysql://192.168.0.103:3306/test --username root --password 123456 --e "delete from hive_analys"

sqoop export --connect jdbc:mysql://192.168.0.103:3306/test --username root --password 123456 --table hive_analys --export-dir /result/type_num -m 1 --input-fields-terminated-by '\t'


四、分析不同种类产品当月销售额hive_analys
产品类型-销售额
1、导入表
sqoop import --connect jdbc:mysql://192.168.0.103:3306/test --username root --password 123456 -m 1 --hive-import --hive-table test.type_price --delete-target-dir --target-dir /test/type_num --hive-overwrite --create-hive-table --query "select * from (select b.sku_type,a.order_price*a.order_num as price from order_detail a,sku_info b where a.sku_id = b.sku_id and a.order_id in (select order_id from order_info where order_status = 1))c where \$CONDITIONS"

2、分析
insert overwrite directory '/result/type_price' ROW FORMAT DELIMITED FIELDS TERMINATED BY '\t' select sku_type as x_info,sum(price) as y_info,'price' as type from type_price group by sku_type

3、导入Mysql
sqoop eval --connect jdbc:mysql://192.168.0.103:3306/test --username root --password 123456 --e "delete from hive_analys"

sqoop export --connect jdbc:mysql://192.168.0.103:3306/test --username root --password 123456 --table hive_analys --export-dir /result/type_price -m 1 --input-fields-terminated-by '\t'

